---
title: "LADS-EDU Final Project: Fabio Campos, Ofer Chen, Trent Hoy, Varalika Singh"
output: html_notebook
---

## 1) Data
The data used in this project were generated by ~500 students from Trent's undergraduate French courses. Trent noted that there are three main language backgrounds represented by his students and that the data might reveal ways to tailor his instruction for each one. We began with a wide range of potential sources (LMS data, discussion forums, online workbook activities, portfolio assignments, etc.) and variables (course level, linguistic background, time spent, assignment content, etc.) and spent much time deliberating about which would be the most useful to examine while not requiring an unreasonable amount of time and effort to retrieve. To guide our decision, we focused on sources that specifically reflected French competency rather than general course engagement.

We ended up selecting 11 variables for our analysis, most of which come from components of the textbook's online workbook (MHConnect):

Online Adaptive Learning Activities (LearnSmart)
* Percent of Questions Answered Correctly (Per_correct)
* Percent of Questions Where Student was Aware of Being Correct or Incorrect (Per_aware)
* Percent of Questions Where Student was Unaware of Being Incorrect (IU)
* Time Spent in Minutes on LearnSmart (Time_LS)
* Percent of Assigned LearnSmart Activities Completed (Per_complete_LS)

Online Homework Activities
* Time Spent in Minutes on Homework Assignments (Time_hw)
* Percent of Homework Questions Answered Correctly (Per_correct_hw)
* Time Spent on Optional Pronunciation Exercises (Time_pron)

Other
* Final Numeric Course Grade
* Linguistic Background
* Sex

Each row in the dataframe represents a student and each column, a different variable.

Due to the limitations of certain data formats when retrieved from the MHConnect system, we decided to look exclusively at first-semester students (FRE1120). Furthermore, only those who completed the course and received a final grade were included. After additional cleaning (described below), the final sample consisted of 129 students across six sections of both face-to-face and online FRE1120 courses.

***

## 2) Question

Armed with this subset of data, we set out to answer two key questions:

1) Can student practice behavior and performance outcomes from the textbook's online workbook be used to meaningfully group students?

2) If we identify meaningful groups, how can Trent use this analysis to support students in future classes, both within these workbook assignments and other aspects of the course?

***

## 3) Approach

To answer these questions, we turned to cluster analysis, as this approach allows us to find groups of students who are similar across multiple variables. Additionally, a close examination of the within cluster means for each variable will help us to generate a persona for each cluster. These different personas may be useful for Trent in designing general instruction or specific interventions. We will also be able to examine the demographic breakdowns of each cluster to see if linguistic background or sex play any role in practice behavior or performance outcome.

***

## 4) Process, Results, & Interpretation

## Data Cleaning

Trent did basic cleaning and organization when compiling and deidentifying the numerous reports from MHConnect, thus we didn't have a lot of additional cleaning work to do.

***

Filtering:

* We removed students in sections where LearnSmart activities were not mandatory so as to compare students who had more similar course requirements.
* We predicted that linguistic background would play a significant role in the behaviors and outcomes measured in our analysis. We therefore decided to focus on the three predominant language groups - English, Spanish, and Haitian Creole. Thus, a handful of students with other backgrounds such as Portuguese, Chinese, and French, were removed.

***

Calculated Variables:

* We created a variable to track the overall percent of correct LearnSmart responses (Per_correct) by adding percent correct and aware and percent correct and unaware.
* We also created a variable to reflect the total percent of awareness of correct/incorrect responses in LearnSmart (Per_aware) by adding percent correct and aware and percent incorrect and aware.

***
For ease of use, we removed unnecessary columns and renamed columns.
 
```{r}
#load relevant libraries
library(dplyr)
library(ggplot2)

#Import data into a new data frame
MasterData<-read.csv("~/downloads/FRE1120 Data Summary - RAW.csv")
#Removing students that were not required to do the LS exercises
MasterData<-MasterData[MasterData$LS.Required=="y",]
#Removing the few students with linguistic background different than English, Spnaish, or Creole due to very low numbers
MasterData<-MasterData[MasterData$Linguistic.Background %in% c("English","Creole","Spanish"),]
#Creating the calculated fields of Per_aware and Per_correct
MasterData <- MasterData %>% mutate(Per_correct = Correct...aware+Correct...unaware)
MasterData <- MasterData %>% mutate(Per_aware = Correct...aware+Incorrect...aware)
#eliminating redundant columns
MasterData<- select(MasterData, "ID..","Sex","Linguistic.Background","Final.Grade","Incorrect...unaware","Per_correct","Per_aware","Time.Spent..HW.","Time.Spent..Pronunciation.Practice.","Time.Spent..LearnSmart.","Total.HW...Correct","Total.LS...Complete",)
#Changing column names
names(MasterData) <- c("ID","Sex","Language","Final_grade","IU","Per_correct","Per_aware","Time_hw","Time_pron","Time_LS","Per_correct_hw","Per_complete_LS")

```

## Variable Exploration

We started looking at the relationships between our variables using the R 'pairs' function.
We then focused on specific pairs of variables and made note of interesting or unexpected relationships.

***
```{r}
#Examine scatter plots for different variable combination pairs
#Creating scatter plots for all pairs
pairs(MasterData)
#Time spent on Connect homework, Percentage of correct homework responses
ggplot(MasterData, aes(Time_hw,Per_correct_hw))+ geom_point() + stat_sum(aes(group = 1))
#Time spent on Connect homework, Time spent on LearnSmart adaptive activities
ggplot(MasterData, aes(Time_hw,Time_LS))+ geom_point() + stat_sum(aes(group = 1))
#Percentage of correct homework responses, Final course grade
ggplot(MasterData, aes(Per_aware,Final_grade))+ geom_point() + stat_sum(aes(group = 1))
#Percentage of correct homework responses, Final course grade
ggplot(MasterData, aes(Per_correct_hw,Final_grade))+ geom_point() + stat_sum(aes(group = 1))
#Percentage of correct LearnSmart responses, Percentage of awareness of correct/incorrect responses
ggplot(MasterData, aes(Per_correct,Per_aware))+ geom_point() + stat_sum(aes(group = 1))
#Percentage of completion of assigned LearnSmart activities, Final course grade
ggplot(MasterData, aes(Per_complete_LS,Final_grade))+ geom_point() + stat_sum(aes(group = 1))
#Percentage of completion of assigned LearnSmart activities, Percentage of incorrect and unaware LearnSmart responses
ggplot(MasterData, aes(Per_complete_LS,IU))+ geom_point() + stat_sum(aes(group = 1))
#Time spent on LearnSmart adaptive activities, Final course grade
ggplot(MasterData, aes(Time_LS,Final_grade))+ geom_point() + stat_sum(aes(group = 1))
#Percentage of incorrect and unaware LearnSmart responses, Final course grade
ggplot(MasterData, aes(IU,Final_grade))+ geom_point() + stat_sum(aes(group = 1))
#Percentage of incorrect and unaware LearnSmart responses, Time spent on LearnSmart adaptive activities
ggplot(MasterData, aes(IU,Time_LS))+ geom_point() + stat_sum(aes(group = 1))
```

### Expected Relationships Between Variables
Some intuitive relationships between variables were evident in the data:

***

* Time spent on homework is correlated with percent of correct homework answers. Yet, it seems that there is a significant portion of students who get better return on their time investment than others which may indicate that other factors are involved in being correct on homework questions and not just time. 
* Time spent on homework and time spent on Learn Smart (LS) are correlated as expected. Those who spent little time on one are likely to spend little time on the other.
* Percent correct on homework assignments is correlated with higher final grade. People who succeed in one are likely to succeed in the other.
* Perhaps the most salient correlation was found between percent of correct answers on LS and percent of correctly noting whether you know the answer or not. This was hypothesized before the analysis phase by the group as a potential obstacle for struggling students: not being aware of their weak spots. This correlation provides a fertile ground for further analysis and suggests potential avenues for Trent to support those students.

### Surprising Relationships or Non-Relationships Between Variables

Some intuitive relationships did not pan out as predicted by the group:

***

* Percent completion of the LearnSmart activities was correlated with final grade, but, the range of grades even for those completing 100% of the activities was very wide. This might give indication to the effectivity of the LS system.

* Percent complete of the Learn Smart activities seemed to *not* correlate with being incorrect and unaware. We had predicted that the more practice you get, the more aware you will be about what you know and don't know. Apparently there may be more factors at play. One of them might be a growing sense of confidence that leads students to mark "I know the answer" more as time goes by, increasing the chances of being incorrect and unaware whenever they make a mistake. Alternatively, the more LS a student does, the less likely they may be to seriously respond to the “How certain are you…?” prompt, favoring whatever is the first option (“Know it”), leading to a skewed percent of incorrect and unaware. Another explanation could be related to questions getting harder as the term progresses.

* A greater overall time spent on LS correlates with a greater percent of incorrect and unaware answers. This is counter to our predictions and may be for the same reasons as the previous bullet point.

* Time spent on LS and final grade are positively correlated. This is interesting because LS only accounted for 5% (F2F) or 8% (online) of the final grade. There appear to be roughly two groups emerging: a) Those for whom spending more time in LS yields a higher grade - the practice is needed and useful, and b) those who earn a high final grade regardless of time in LS - perhaps those with prior knowledge or who understand the content without extended practice. Thus time spent on LS alone is not directly indicative of final grade, though it may be indicative of other processes at play.

* Being incorrect and unaware does not seem to correlate strongly with final grades. This is a good point for investigation after the clustering phase is done.

***

## Scaling the Data

We scaled the model variables and created a new data frame for clustering. 
We made sure that the variables were scaled as expected (mean = 0, sd = 1).

```{r}
#Create new data frame for scaled data, removing non-clustering variables
ScaledData<-as.data.frame(cbind(MasterData[,1:3],scale(select(MasterData, Final_grade:Per_complete_LS))))
#Validating scaling by looking at means and standard deviations of the scaled columns
sapply(ScaledData[,4:12], mean)
sapply(ScaledData[,4:12], sd)
```

## Determining the Number of Meaningful Clusters

We started out by creating a WSS plot. The results showed promise for a 3 or 5 cluster solution.
We used the kmeans model to explore 3, 4, and 5 cluster solutions.


```{r}
#Creating the Within Group Sum of Squares function
wssplot <- function(data, nc=15, seed=1234){
  wss <- (nrow(data)-1)*sum(apply(data,2,var))
  for (i in 2:nc){
    set.seed(seed)
    wss[i] <- sum(kmeans(data, centers=i)$withinss)}
  plot(1:nc, wss, type="b", xlab="Number of Clusters",
       ylab="Within groups sum of squares")}

#Create the WSS Graph
wssplot(ScaledData[,4:12],nc=15,seed=1234)
```
## Model Outcomes

* __Three Clusters:__

```{r}
#Create and examine several different possible cluster solutions
threeclusterkmeans<-kmeans(ScaledData[,4:12], 3, nstart=10)
threeclusterkmeans
```
Reviewing the outcomes from the 3 models raised some issues we needed to address. The three cluster solution painted  a picture in which 2 clusters are doing well, while one smaller cluster contained students who seemed not to engage with the course's online materials. This seemed too simplistic (either you're not working enough or you are doing just fine). Trent knows he has students engaging with the course that do not achieve the same final outcomes as others, especially when comparing the time they work on their assignments to the time spent by other students. We decided that a 3 cluster solution would not be meaningful enough for Trent.

***

* __Four Clusters:__

```{r}
fourclusterkmeans<-kmeans(ScaledData[,4:12], 4, nstart=10)
fourclusterkmeans
```
Even though at first it did not seem like the best clustering solution, the four cluster solution gives us an interesting view of Trent's classes and points out to a few meaningful student personas. Those personas might be characterized as:

  __Average Effort / Average Outcome__ (Cluster 1 centroid) - These students are the largest cluster and as such they are also pretty much average on most of the dimensions we chose for the model. 
  __Low Effort / High Outcome__ (Cluster 2 centroid) - These students are the second largest cluster in this analysis. Their final grades are typically higher, yet they spend less time than other clusters on activities. For example, they complete more of the LS activities in less time than clusters 1 and 3. They also spent less time on homework than clusters 1 and 3 to achieve higher correct rate on those questions.
    __High Effort / Low Outcome__ (Cluster 3 centroid) - These students seems to have a harder time in this course than others. They typically spend a lot more time on assignments yet get lower grades for them. An interesting point is that this group is also a lot more incorrect and unaware than all other groups. This may be an indication of a potential gap between what they know and what they think they know.
    __Very Low Effort / Very Low Outcome__ (Cluster 4 centroid) - Students within this cluster are typically not engaged with the course's online material, complete very few LS activities, which results in very low final grades. If Trent wants to address the needs of those students, he will have to take a different approach than the one he will use to address the needs of students in cluster 3.

***

* __Five Clusters:__

```{r}
fiveclusterkmeans<-kmeans(ScaledData[,4:12], 5, nstart=10)
fiveclusterkmeans
```

We moved on to look at what we had initially considered as the second promising point. The additional cluster primarily broke apart students doing very well and two smaller groups emerged: a) Those who spend more time in the online workbook activities, thereby earning higher grades, and b) those who earn high grades in spite of spending less time in the online workbook. While insightful, the added granularity among high performing students is less useful. Those students already seem to know how to succeed in the course, so additional tailoring or intervention would be less impactful than focusing on struggling students.

For the purposes of this project, we decided to focus on the four cluster solution as it captures a larger group of high effort/low outcome students.

***

## Visualizing the Clusters

### Assigning Observations to Clusters

```{r}
#Assign the clusters for each observation for k=3,4 to a new dataframe
Clusters<-data.frame(ScaledData, as.factor(threeclusterkmeans$cluster), as.factor(fourclusterkmeans$cluster))
names(Clusters) <- c("ID","Sex","Language","Final_grade","IU","Per_correct","Per_aware","Time_hw","Time_pron","Time_LS","Per_correct_hw","Per_complete_LS","ClusterToThree","ClusterToFour")
```

### Going Back to the Variables

We went back to the visualizaitons we started with.  
This second round includes cluster information, so we can now see how the clusters differ on those dimensions of interest.

```{r}
#Graph the different solutions - Four Clusters.
#Shapes indicate Language Background. To change which variable is marked by shape, change the name of the variable in "shape=Language
ggplot(Clusters, aes(Time_hw,Per_correct_hw, group = factor(ClusterToFour))) + geom_point((aes(size=2,shape=Language, color = factor(ClusterToFour))))
ggplot(Clusters, aes(Time_hw,Time_LS, group = factor(ClusterToFour))) + geom_point((aes(size=2,shape=Language, color = factor(ClusterToFour))))
ggplot(Clusters, aes(Per_correct_hw,Final_grade, group = factor(ClusterToFour))) + geom_point((aes(size=2,shape=Language, color = factor(ClusterToFour))))
ggplot(Clusters, aes(Per_correct,Per_aware, group = factor(ClusterToFour))) + geom_point((aes(size=2,shape=Language, color = factor(ClusterToFour))))
ggplot(Clusters, aes(Per_complete_LS,Final_grade, group = factor(ClusterToFour))) + geom_point((aes(size=2,shape=Language, color = factor(ClusterToFour))))
ggplot(Clusters, aes(Per_complete_LS,IU, group = factor(ClusterToFour))) + geom_point((aes(size=2,shape=Language, color = factor(ClusterToFour))))
ggplot(Clusters, aes(Time_LS,Final_grade, group = factor(ClusterToFour))) + geom_point((aes(size=2,shape=Language, color = factor(ClusterToFour))))
ggplot(Clusters, aes(IU,Final_grade, group = factor(ClusterToFour))) + geom_point((aes(size=2,shape=Language, color = factor(ClusterToFour))))
ggplot(Clusters, aes(IU,Time_LS, group = factor(ClusterToFour))) + geom_point((aes(size=2,shape=Language, color = factor(ClusterToFour))))
```

***

## Cluster Statistics

We wanted to review the actual values of the cluster centroids and not just the scaled values.

```{r}

# Adding the clusters to the unscaled df
UnscaledClusters<-data.frame(MasterData, as.factor(threeclusterkmeans$cluster), as.factor(fourclusterkmeans$cluster))
names(UnscaledClusters) <- c("ID","Sex","Language","Final_grade","IU","Per_correct","Per_aware","Time_hw","Time_pron","Time_LS","Per_correct_hw","Per_complete_LS","ClusterToThree","ClusterToFour")
MeanTable <- data.frame("Final_grade"=double(),"IU"=double(),"Per_correct"=double(),"Per_aware"=double(),"Time_hw"=double(),"Time_pron"=double(),"Time_LS"=double(),"Per_correct_hw"=double(),"Per_complete_LS"=double())
```

```{r}
for (i in 1:4){
    MeanTable [i,1]<- mean(UnscaledClusters$Final_grade[UnscaledClusters$ClusterToFour==i])
    MeanTable [i,2]<- mean(UnscaledClusters$IU[UnscaledClusters$ClusterToFour==i])
    MeanTable [i,3]<- mean(UnscaledClusters$Per_correct[UnscaledClusters$ClusterToFour==i])
    MeanTable [i,4]<- mean(UnscaledClusters$Per_aware[UnscaledClusters$ClusterToFour==i])
    MeanTable [i,5]<- mean(UnscaledClusters$Time_hw[UnscaledClusters$ClusterToFour==i])
    MeanTable [i,6]<- mean(UnscaledClusters$Time_pron[UnscaledClusters$ClusterToFour==i])
    MeanTable [i,7]<- mean(UnscaledClusters$Time_LS[UnscaledClusters$ClusterToFour==i])
    MeanTable [i,8]<- mean(UnscaledClusters$Per_correct_hw[UnscaledClusters$ClusterToFour==i])
    MeanTable [i,9]<- mean(UnscaledClusters$Per_complete_LS[UnscaledClusters$ClusterToFour==i])
}
row.names(MeanTable) <- c("Cluster 1", "Cluster 2", "Cluster 3", "Cluster 4")
MeanTable
```

From analyzing the unscaled means we get a stronger sense of the differences between the clusters in meaningful terms. For example, the High Effort / Low Outcome students (Cluster 3) are spending on average more than double the amount of time on LS (500+ mins vs ~225 mins) than other groups and 50% more time on homework (~1700 mins vs ~1100 mins) than other groups. Yet they are correct less than 50% of the time and only unaware of being incorrect for more than a third of the questions.

This view of the data also shows general trends across the class, namely that correctness improves from LearnSmart to homework activities. This makes sense given that LS is assigned as formative assessment and review between classes while homework is due at the end of a unit as a form of summative assessment.

## Demographic Analysis

In addition, we wanted to see if some populations are over-represented in some of the clusters.

```{r}
#creating languages vector and proportion tables for both demogrpahic variables
langs <- c("English","Spanish","Creole")
prop.table(table(Clusters$Language,Clusters$ClusterToFour),1)[c(2,3,6),] # within language cluster proportion
prop.table(table(Clusters$Language,Clusters$ClusterToFour),2)[c(2,3,6),] # within cluster language proportion
prop.table(table(Clusters$Sex,Clusters$ClusterToFour),1) # within sex cluster proportion
prop.table(table(Clusters$Sex,Clusters$ClusterToFour),2) # within cluster sex proportion
```
__Tables 1 & 2: Distribution of language background across/within clusters__
Given the ~1:2:1 ratio of Creole, English, and Spanish within this sample, the even distributions of language backgrounds within most clusters show that linguistic background has little impact on course performance - a bit of a surprising result given anecdotal evidence. One exception, however, may be that within this sample, those with a background in Spanish were less likely to be in the High Effort/Low Outcome group (Cluster 3). Given that those students were characterized by a low awareness of being incorrect, it could be that Spanish speakers are more cognizant of the differences between French and their native language than speakers of English or Haitian Creole.

__Tables 3 & 4: Distribution of sex across/within clusters__
The sample contains a ~2:1 ratio of females to males, thus sex does not appear to affect the low outcome cluster distributions in a meaningful way.

***

## 5) Conclusion
Based on our analysis, the answer to the question we have asked is yes, student practice behaviors and performance outcomes from the textbook's online workbook can be used to meaningfully group students. We also feel that given the specific variables we used to answer our question, we were able to identify the challenges that different student groups face. Therefore, the data and our analysis can provide insights into possible actionable steps Trent could take to help each student group. We are confident in the analysis we conducted but, also do recognize that the online workbook activities only make up for 25% of the course grade and therefore, we could be missing other important pieces of the puzzle. Within different student groups, there might be multiple reasons for low motivation or low grades. We would have to go deeper in to other aspects of student behavior such as class participation and other assignment grades for a more refined conclusion.
***

## 6) Reflection
One of the challenges we encountered was narrowing down on questions that would provide Trent with meaningful insights to help his students, in future courses. The breadth of data that was available required us to take a decision very early on about which variables we wish to include in our analysis, to avoid downloading and cleaning data that would not help in answering our questions. 
We mostly relied on each other's strenghts for help, with team members who have stronger R skills helping those who were struggling with coding.
If we had more time to keep working on the project we would probably conduct a wider analysis, incorporating additional variables to help paint a more holistic picture of the students and their learning behaviors.